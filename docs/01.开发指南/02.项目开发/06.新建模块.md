---
title: 新建模块
date: 2023-10-23 17:30:28
permalink: /pages/新建模块/
categories:
  - 开发
tags:
---
我一向喜欢简化操作，只需以下几步，便可创建自己的服务模块。


## Step1 新建Maven模块

在```fish-modules``` 模块下新建个Maven模块，命名为```fish-example```





## Step2 导入需要使用的模块

最基础的模块，建议选用以下模块
- alter-mvc
- alter-jpa
- alter-mysql
- alter-redis
- alter-security（视情况而定）
###  Step2.1  不使用SpringSecurity

无需做任何操作
### Step2.2 使用SpringSecurity
如果想使用SpringSecurity功能，导入alter-security模块，然后实现一个CloudUserService接口即可。以下是```fish-logging```模块实现的例子。

```java
@Component  
@RequiredArgsConstructor  
public class LogCloudUserDetailService implements CloudUserDetailService {  
    private final SysUserClientService sysUserClientService;  
  
    /**  
     * 从token中解析用户信息  
     * 这里直接返回一个new Object() 值。
     * @param token  
     */  
    @Override  
    public Object resolveUserByToken(String token) {  
//        return sysUserClientService.resolveUserByToken(jwt);  
        return new Object();  
    }  
  
    /**  
     * 根据用户名获取用户信息  
     * 远程调用system-admin模块获取内容
     * @param username  
     * @return  
     * @throws UsernameNotFoundException  
     */  
    @Override  
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {  
        UserDetails userDetails = sysUserClientService.loadUserByUsername(username);  
        return userDetails;  
    }  
}
```

## Step3 修改fish-modules模块文件
在pom.xml的modules节点中添加如下内容。
```xml
<module>fish-example</module>
```
## Step4 添加SpringBoot配置文件
编辑application.yaml文件，添加对应的配置，必须设置属性```spring.application.name```，否则无法注册到Nacos中。
```
```yaml
server:  
  port: 9014   # web端口
spring:  
  application:  
    name: fish-example
```
其次在Step2中选择了哪些模块就需要添加对应的配置文件，对应关系如下：
- alter-mysql
```yaml
spring:  
  datasource:  
    druid:  
      db-type: com.alibaba.druid.pool.DruidDataSource  
      driverClassName: net.sf.log4jdbc.sql.jdbcapi.DriverSpy  
      url: jdbc:log4jdbc:mysql://localhost:3306/eladmindb?serverTimezone=Asia/Shanghai&characterEncoding=utf8&useSSL=false  
      username: root 
      password: 123456
```
- alter-redis
```xml
spring:
	redis:  
	  #数据库索引  
	  database: 1 
	  host: 127.0.0.1
	  port: 6379
	  password: 
	  #连接超时时间  
	  timeout: 5000
```

## Step5 配置SpringBoot启动类
在模块启动类上添加```@EnableDiscoveryClient```注解，让其注册到Nacos中。


## Step6 写一个测试接口
为了测试连通性，添加一个测试接口，代码如下：
```java

```

## Step7 配置网关转发



## Step7 启动项目


## Step8 测试接口连通性